{"name":"Update README.md","on":{"push":{"branches":["master"]}},"jobs":{"build":{"runs-on":"ubuntu-latest","steps":[{"uses":"actions/checkout@v2"},{"name":"Install dependencies","run":"composer install --prefer-dist --no-progress --no-suggest"},{"name":"update readme","run":"php misc/update-readme.php"},{"name":"Prepare git config","run":"cat <<- EOF > $HOME/.netrc\n  machine github.com\n  login $GITHUB_ACTOR\n  password $GITHUB_TOKEN\n  machine api.github.com\n  login $GITHUB_ACTOR\n  password $GITHUB_TOKEN\nEOF\nchmod 600 $HOME/.netrc\ngit config --global user.email \"$GITHUB_ACTOR@users.noreply.github.com\"\ngit config --global user.name \"$GITHUB_ACTOR\"\n"},{"name":"push changes & create PR","run":"changes=($( git diff --numstat ))\nif [[ ${changes[0]} -gt 1 ]]\nthen\n  cd $GITHUB_WORKSPACE\n  git push origin --delete updatereadme || true\n  git branch -D updatereadme || true\n  git checkout -b updatereadme\n  git add README.md\n  git commit -m \"update README.md\"\n  git push --set-upstream origin updatereadme\n  curl \\\n       --request POST \\\n       --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \\\n       --header 'content-type: application/json' \\\n       --data '{\n        \"title\":\"Update README.md\",\n        \"body\":\"updates detections in README.md\",\n        \"head\":\"updatereadme\",\n        \"base\":\"master\"\n        }' \\\n       --url https://api.github.com/repos/${GITHUB_REPOSITORY}/pulls\nfi\n","shell":"bash"}]}}}